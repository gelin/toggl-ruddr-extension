async function s(){return chrome.storage.sync.get("toggl_api_token").then(t=>t==null?void 0:t.toggl_api_token).catch(t=>null)}async function d(){return chrome.storage.sync.get("toggl_workspace_id").then(t=>t==null?void 0:t.toggl_workspace_id).catch(t=>null)}async function E(t){return chrome.storage.sync.set({toggl_api_token:t.token,toggl_workspace_id:t.workspace}).then(o=>f(t.token)).then(o=>y(t.token))}async function A(t){return fetch("https://api.track.toggl.com/api/v9/me/logged",{method:"GET",headers:{Authorization:`Basic ${btoa(t+":api_token")}`}}).then(o=>{if(o.ok)return"SUCCESS";throw new Error("FAILED: not OK response")}).catch(o=>{throw console.log("Failed to fetch me/logged",o),new Error("FAILED: "+o.message)})}async function C(){const t=await d();return(await chrome.storage.local.get("toggl_workspaces").then(e=>(e==null?void 0:e.toggl_workspaces)||[]).catch(e=>[])).map(e=>(e.selected=e.id===t,e))}async function u(t){return chrome.storage.local.set({toggl_workspaces:t})}async function F(t){const o=t??await s();return fetch("https://api.track.toggl.com/api/v9/me/workspaces",{method:"GET",headers:{Authorization:`Basic ${btoa(o+":api_token")}`}}).then(e=>e.json()).then(e=>{const n=e.map(c=>({id:c.id,name:c.name}));return u(n),n}).catch(e=>{throw console.log("Failed to fetch me/workspaces",e),e})}async function m(){return(await chrome.storage.local.get("toggl_clients").then(e=>(e==null?void 0:e.toggl_clients)||[]).catch(e=>[])).reduce((e,n)=>(e.set(n.id,{id:n.id,name:n.name}),e),new Map)}function _(t){return chrome.storage.local.set({toggl_clients:t})}async function f(t){const o=t??await s();return fetch("https://api.track.toggl.com/api/v9/me/clients",{method:"GET",headers:{Authorization:`Basic ${btoa(o+":api_token")}`}}).then(e=>e.json()).then(e=>{const n=e.map(c=>({id:c.id,name:c.name}));return _(n)}).catch(e=>{throw console.log("Failed to fetch me/clients",e),e})}async function k(){const t=await chrome.storage.local.get("toggl_projects").then(n=>(n==null?void 0:n.toggl_projects)||[]).catch(n=>[]),o=await m();return t.reduce((n,c)=>(n.set(c.id,{id:c.id,name:c.name,client:o.get(c.client_id)}),n),new Map)}async function w(t){return chrome.storage.local.set({toggl_projects:t})}async function y(t){const o=t??await s();return fetch("https://api.track.toggl.com/api/v9/me/projects",{method:"GET",headers:{Authorization:`Basic ${btoa(o+":api_token")}`}}).then(e=>e.json()).then(e=>{const n=e.map(c=>({id:c.id,name:c.name,client_id:c.client_id}));return w(n)}).catch(e=>{throw console.log("Failed to fetch me/projects",e),e})}async function j(){return chrome.storage.sync.get("toggl_project_mappings").then(t=>(t==null?void 0:t.toggl_project_mappings)||{}).catch(t=>({}))}async function $(t){const o=await s(),e=await d();return console.log(`Fetching report for date=${t} in workspace=${e}`),fetch(`https://api.track.toggl.com/reports/api/v3/workspace/${e}/summary/time_entries`,{method:"POST",headers:{Authorization:`Basic ${btoa(o+":api_token")}`,"Content-Type":"application/json"},body:JSON.stringify({start_date:t,end_date:t,grouping:"projects",sub_grouping:"time_entries"})}).then(n=>n.json()).then(n=>M(n)).catch(n=>{throw console.warn("Failed to fetch summary/time_entries",n),n})}async function M(t){var c;const o=await k(),e=await j(),n=[];return(c=t==null?void 0:t.groups)==null||c.forEach(a=>{var l;const p=a.id,g=[];let r=0,h="#000";(l=a==null?void 0:a.sub_groups)==null||l.forEach(i=>{g.push(i.title),r+=i.seconds,h=i.project_hex_color}),r>0&&n.push({project:o.get(p),color:h,seconds:T(r),description:g.join(`
`),mapping:e[p]})}),n}function T(t){return Math.ceil(t/900)*900}export{s as a,C as b,$ as f,d as g,F as r,E as s,A as t};
