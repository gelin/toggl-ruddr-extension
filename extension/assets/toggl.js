async function s(){return chrome.storage.sync.get("toggl_api_token").then(t=>t==null?void 0:t.toggl_api_token).catch(t=>null)}async function d(){return chrome.storage.sync.get("toggl_workspace_id").then(t=>t==null?void 0:t.toggl_workspace_id).catch(t=>null)}async function E(t){return chrome.storage.sync.set({toggl_api_token:t.token,toggl_workspace_id:t.workspace}).then(n=>f(t.token)).then(n=>y(t.token))}async function S(t){return fetch("https://api.track.toggl.com/api/v9/me/logged",{method:"GET",headers:{Authorization:`Basic ${btoa(t+":api_token")}`}}).then(n=>{if(n.ok)return"SUCCESS";throw new Error("FAILED: not OK response")}).catch(n=>{throw console.log("Failed to fetch me/logged",n),new Error("FAILED: "+n.message)})}async function C(){const t=await d();return(await chrome.storage.local.get("toggl_workspaces").then(e=>(e==null?void 0:e.toggl_workspaces)||[]).catch(e=>[])).map(e=>(e.selected=e.id===t,e))}async function u(t){return chrome.storage.local.set({toggl_workspaces:t})}async function F(t){const n=t??await s();return fetch("https://api.track.toggl.com/api/v9/me/workspaces",{method:"GET",headers:{Authorization:`Basic ${btoa(n+":api_token")}`}}).then(e=>e.json()).then(e=>{const o=e.map(c=>({id:c.id,name:c.name}));return u(o),o}).catch(e=>{throw console.log("Failed to fetch me/workspaces",e),e})}async function m(){return(await chrome.storage.local.get("toggl_clients").then(e=>(e==null?void 0:e.toggl_clients)||[]).catch(e=>[])).reduce((e,o)=>(e.set(o.id,{id:o.id,name:o.name}),e),new Map)}function _(t){return chrome.storage.local.set({toggl_clients:t})}async function f(t){const n=t??await s();return fetch("https://api.track.toggl.com/api/v9/me/clients",{method:"GET",headers:{Authorization:`Basic ${btoa(n+":api_token")}`}}).then(e=>e.json()).then(e=>{const o=e.map(c=>({id:c.id,name:c.name}));return _(o)}).catch(e=>{throw console.log("Failed to fetch me/clients",e),e})}async function k(){const t=await chrome.storage.local.get("toggl_projects").then(o=>(o==null?void 0:o.toggl_projects)||[]).catch(o=>[]),n=await m();return t.reduce((o,c)=>(o.set(c.id,{id:c.id,name:c.name,client:n.get(c.client_id)}),o),new Map)}async function w(t){return chrome.storage.local.set({toggl_projects:t})}async function y(t){const n=t??await s();return fetch("https://api.track.toggl.com/api/v9/me/projects",{method:"GET",headers:{Authorization:`Basic ${btoa(n+":api_token")}`}}).then(e=>e.json()).then(e=>{const o=e.map(c=>({id:c.id,name:c.name,client_id:c.client_id}));return w(o)}).catch(e=>{throw console.log("Failed to fetch me/projects",e),e})}async function j(){return chrome.storage.sync.get("toggl_project_mappings").then(t=>(t==null?void 0:t.toggl_project_mappings)||{}).catch(t=>({}))}async function A(t){const n=await s(),e=await d();return console.log(`Fetching report for date=${t} in workspace=${e}`),fetch(`https://api.track.toggl.com/reports/api/v3/workspace/${e}/summary/time_entries`,{method:"POST",headers:{Authorization:`Basic ${btoa(n+":api_token")}`,"Content-Type":"application/json"},body:JSON.stringify({start_date:t,end_date:t,grouping:"projects",sub_grouping:"time_entries"})}).then(o=>o.json()).then(o=>T(o)).catch(o=>{throw console.warn("Failed to fetch summary/time_entries",o),o})}async function T(t){var c;const n=await k(),e=await j(),o=[];return(c=t==null?void 0:t.groups)==null||c.forEach(a=>{var h;const g=a.id,l=[];let r=0,p="#000";(h=a==null?void 0:a.sub_groups)==null||h.forEach(i=>{l.push(i.title),r+=i.seconds,p=i.project_hex_color}),r>0&&o.push({project:n.get(g),color:p,seconds:M(r),description:l.join(`
`),mapping:e[g]})}),o}function M(t){return Math.ceil(t/900)*900}export{F as a,d as b,E as c,s as d,C as e,A as f,S as t};
